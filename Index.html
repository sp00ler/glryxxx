<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Галерея изображений</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }
    .gallery-container {
        max-width: 1200px;
        margin: auto;
        padding: 15px;
    }
    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        margin-bottom: 15px;
    }
    .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 8px;
    }
    .gallery img {
        width: 100%;
        height: 120px;
        object-fit: cover;
        border-radius: 6px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
    }
    .gallery img:hover {
        transform: scale(1.03);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    /* Fullscreen */
    .fullscreen {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.95);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }
    .fullscreen img {
        max-width: 95%;
        max-height: 85%;
        transition: opacity 0.3s ease;
    }
    .fullscreen-controls {
        position: absolute;
        bottom: 20px;
        display: flex;
        gap: 15px;
    }
    .btn {
        padding: 8px 12px;
        font-size: 14px;
        border: none;
        border-radius: 4px;
        background: rgba(255,255,255,0.2);
        color: #fff;
        cursor: pointer;
        backdrop-filter: blur(4px);
    }
    .btn:hover {
        background: rgba(255,255,255,0.35);
    }
    .error {
        color: red;
        text-align: center;
    }
    @media (min-width: 600px) {
        .gallery img {
            height: 150px;
        }
    }
</style>
</head>
<body>
<div class="gallery-container">
    <div class="controls">
        <input type="file" id="fileInput" accept="image/*" multiple>
        <button class="btn" id="toggleSlideshow">Случайный показ</button>
        <select id="intervalSelect">
            <option value="2">2 секунды</option>
            <option value="3">3 секунды</option>
            <option value="5">5 секунд</option>
            <option value="7">7 секунд</option>
        </select>
    </div>
    <div class="error" id="errorMessage"></div>
    <div class="gallery" id="gallery"></div>
</div>

<div class="fullscreen" id="fullscreen">
    <img id="fullscreenImage" src="" alt="">
    <div class="fullscreen-controls">
        <button class="btn" onclick="prevImage()">⟨</button>
        <button class="btn" onclick="exitFullscreen()">✕</button>
        <button class="btn" onclick="nextImage()">⟩</button>
    </div>
</div>

<script>
let images = [], currentIndex = 0, slideshowInterval = null, isSlideshowRunning = false;

const errorMessage = document.getElementById('errorMessage');
const gallery = document.getElementById('gallery');
const fullscreen = document.getElementById('fullscreen');
const fullscreenImage = document.getElementById('fullscreenImage');

function showError(msg){ errorMessage.textContent = msg; }
function clearError(){ errorMessage.textContent = ''; }

document.getElementById('fileInput').addEventListener('change', (e) => {
    clearError();
    images = [];
    gallery.innerHTML = '';
    for (let file of e.target.files) {
        if (!file.type.startsWith('image/')) continue;
        const url = URL.createObjectURL(file);
        images.push(url);
        const img = document.createElement('img');
        img.src = url;
        img.onclick = () => showFullscreen(images.indexOf(url));
        gallery.appendChild(img);
    }
    if (!images.length) showError('Не удалось загрузить изображения');
});

function showFullscreen(index){
    if(index < 0 || index >= images.length) return;
    currentIndex = index;
    fullscreenImage.style.opacity = 0;
    fullscreen.style.display = 'flex';
    setTimeout(() => {
        fullscreenImage.src = images[currentIndex];
        fullscreenImage.style.opacity = 1;
    }, 100);
}

function exitFullscreen(){
    fullscreen.style.display = 'none';
    stopSlideshow();
}

function prevImage(){
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    showFullscreen(currentIndex);
}

function nextImage(){
    currentIndex = (currentIndex + 1) % images.length;
    showFullscreen(currentIndex);
}

function showRandomImage(){
    currentIndex = Math.floor(Math.random() * images.length);
    showFullscreen(currentIndex);
}

document.getElementById('toggleSlideshow').onclick = () => {
    isSlideshowRunning ? stopSlideshow() : startSlideshow();
};

function startSlideshow(){
    if (!images.length) return showError('Загрузите изображения');
    isSlideshowRunning = true;
    document.getElementById('toggleSlideshow').textContent = 'Остановить';
    showRandomImage();
    slideshowInterval = setInterval(showRandomImage, parseInt(document.getElementById('intervalSelect').value)*1000);
}

function stopSlideshow(){
    isSlideshowRunning = false;
    document.getElementById('toggleSlideshow').textContent = 'Случайный показ';
    clearInterval(slideshowInterval);
}

// Закрытие по клику вне картинки
fullscreen.addEventListener('click', (e) => {
    if (e.target === fullscreen) exitFullscreen();
});

// Свайпы для мобильных
let touchStartX = 0;
fullscreen.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
});
fullscreen.addEventListener('touchend', (e) => {
    let diff = e.changedTouches[0].screenX - touchStartX;
    if (diff > 50) prevImage();
    else if (diff < -50) nextImage();
});
</script>
</body>
</html>